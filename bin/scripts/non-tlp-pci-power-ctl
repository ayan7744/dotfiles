#!/bin/sh

# Handles PCI devices unhandled by TLP; powertop reports them as bad.
# Corresponding /etc/udev/rules.d/99-non-tlp-pci-power-ctl.rules.

power_control () {
    echo "$1" | tee /sys/bus/pci/devices/0000:04:00.0/ata1/power/control
    echo "$1" | tee /sys/bus/pci/devices/0000:00:02.2/power/control
    echo "$1" | tee /sys/bus/pci/devices/0000:04:00.1/ata2/power/control
}

_help () {
/usr/bin/cat << 'EOF' 
OPTIONS: --auto, --on

    Handles PCI devices unhandled by TLP; powertop reports them as bad.
    Corresponding /etc/udev/rules.d/99-non-tlp-pci-power-ctl.rules.
EOF
}

case "$1" in 
    "--auto")
        power_control auto
        ;;
    "--on")
        power_control on
        ;;
    *)
        _help
        exit 0
        ;;
esac
